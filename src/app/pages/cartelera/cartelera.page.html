<ion-content class="custom-cartelera">
  <!-- üîπ Encabezado -->
  <header>
    <div class="page-title">
      <img src="assets/logo-light-transparent.png" alt="Logo" class="logo-img" />
    </div>
    <button class="menu-toggle" id="menu-toggle" (click)="toggleMenu()">&#9776;</button>
  </header>

  <!-- üîπ Men√∫ lateral -->
  <aside class="sidebar" [class.active]="menuAbierto">
    <div class="sidebar-header">
      <h3>Men√∫</h3>
      <button class="close-btn" (click)="toggleMenu()">‚úï</button>
    </div>
    <ul>
      <li><a routerLink="/home" (click)="toggleMenu()">Inicio</a></li>
      <li><a routerLink="/cartelera" class="active" (click)="toggleMenu()">Pel√≠culas</a></li>
      <li><a routerLink="/series" (click)="toggleMenu()">Series</a></li>
      <li><a routerLink="/mi-lista" (click)="toggleMenu()">Mi lista</a></li>
      <li><a routerLink="/profile" (click)="toggleMenu()">Perfil</a></li>
      <li class="logout" (click)="logout()">
        <i class="fa-solid fa-right-from-bracket"></i> Cerrar sesi√≥n
      </li>
    </ul>
  </aside>

  <!-- üîπ Contenedor principal -->
  <div class="cartelera-container" [class.menu-open]="menuAbierto">

    <!-- üé¨ Categor√≠as -->
    <aside class="categorias">
      <h3>Categor√≠as</h3>
      <ul>
        <li
          *ngFor="let categoria of categorias"
          (click)="filtrarPorCategoria(categoria)"
          [class.active]="categoriaSeleccionada === categoria"
        >
          {{ categoria }}
        </li>
      </ul>

      <!-- üëë Bot√≥n solo para admin -->
      <div *ngIf="esAdmin" class="admin-actions">
        <button (click)="abrirModalAgregar()" class="add-btn">+ Agregar Pel√≠cula</button>
      </div>
    </aside>

    <!-- üé• Contenido principal -->
    <main class="main-content">
      <!-- üîé Barra de b√∫squeda -->
      <div class="search-bar">
        <input
          type="text"
          placeholder="Buscar pel√≠cula..."
          [(ngModel)]="terminoBusqueda"
          (input)="buscarPeliculas()"
        />
      </div>

      <!-- üß© Grilla de pel√≠culas -->
      <div class="movies-grid">
        <div
          class="movie-card"
          *ngFor="let movie of peliculasFiltradas"
          (click)="verDetalle(movie.id)"
        >
          <img [src]="movie.imageUrl" alt="{{ movie.title }}" />
          <h4>{{ movie.title }}</h4>
          <p>{{ movie.category }}</p>

          <!-- üõ†Ô∏è Controles de administrador -->
          <div *ngIf="esAdmin" class="admin-controls">
            <button
              (click)="abrirModalEditar(movie); $event.stopPropagation()"
              class="edit-btn"
              title="Editar"
            >‚úèÔ∏è</button>
            <button
              (click)="confirmarEliminacion(movie.id); $event.stopPropagation()"
              class="delete-btn"
              title="Eliminar"
            >üóëÔ∏è</button>
          </div>
        </div>
      </div>

      <!-- üëë Panel informativo del admin -->
      <section *ngIf="esAdmin" class="admin-panel">
        <h2>Panel de Administraci√≥n</h2>
        <p>Desde aqu√≠ puedes agregar, editar o eliminar pel√≠culas de la cartelera.</p>
        <button class="admin-add" (click)="abrirModalAgregar()">‚ûï Agregar Pel√≠cula</button>
      </section>
    </main>
  </div>

  <!-- üî∏ MODAL AGREGAR / EDITAR -->
  <ion-modal [isOpen]="modalAbierto" (didDismiss)="cerrarModal()">
    <ng-template>
      <ion-header>
        <ion-toolbar color="dark">
          <ion-title>{{ editando ? 'Editar Pel√≠cula' : 'Agregar Pel√≠cula' }}</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="cerrarModal()">Cerrar</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <ion-content class="ion-padding">
        <ion-item>
          <ion-label position="floating">T√≠tulo</ion-label>
          <ion-input [(ngModel)]="peliculaTemp.title" required></ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="floating">URL de la imagen</ion-label>
          <ion-input [(ngModel)]="peliculaTemp.imageUrl" required></ion-input>
        </ion-item>

        <ion-item>
          <ion-label>Categor√≠a</ion-label>
          <ion-select [(ngModel)]="peliculaTemp.category" interface="alert" placeholder="Seleccionar categor√≠a">
            <ion-select-option *ngFor="let cat of categorias" [value]="cat">{{ cat }}</ion-select-option>
          </ion-select>
        </ion-item>

        <ion-item>
          <ion-label position="floating">Descripci√≥n (opcional)</ion-label>
          <ion-textarea [(ngModel)]="peliculaTemp.description"></ion-textarea>
        </ion-item>

        <ion-item>
          <ion-label position="floating">URL del tr√°iler (opcional)</ion-label>
          <ion-input [(ngModel)]="peliculaTemp.trailerUrl" placeholder="https://youtube.com/..."></ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="floating">URL de la pel√≠cula (opcional)</ion-label>
          <ion-input [(ngModel)]="peliculaTemp.movieUrl" placeholder="https://cdn.mi-sitio/..."></ion-input>
        </ion-item>

        <ion-button expand="block" color="warning" (click)="guardarPelicula()">
          {{ editando ? 'Guardar Cambios' : 'Agregar Pel√≠cula' }}
        </ion-button>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>
