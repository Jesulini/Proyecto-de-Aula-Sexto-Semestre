<ion-content class="custom-cartelera">
  <app-header [pageTitle]="'Cartelera Peliculas'" (toggleMenuEvent)="menu.toggleMenu()"></app-header>
  <app-sidebar-menu #menu [esAdmin]="esAdmin"></app-sidebar-menu>

  <div class="cartelera-container" [class.menu-open]="menu.menuAbierto">
    <aside class="categorias">
      <h3>Categorías</h3>
      <ul>
        <li *ngFor="let categoria of categorias" 
            (click)="filtrarPorCategoria(categoria)"
            [class.active]="categoriaSeleccionada === categoria">
          {{ categoria }}
        </li>
      </ul>

      <div *ngIf="esAdmin" class="admin-actions">
        <button (click)="abrirModalAgregar()" class="add-btn">Agregar Película</button>
      </div>
    </aside>

    <main class="main-content">
      <div class="search-bar">
        <input type="text" placeholder="Buscar película..." [(ngModel)]="terminoBusqueda" (input)="buscarPeliculas()" />
      </div>

      <div class="movies-grid">
        <div class="movie-card" *ngFor="let movie of peliculasFiltradas" (click)="verDetalle(movie.id)">
          <img [src]="movie.imageUrl" alt="{{ movie.title }}" />
          <h4>{{ movie.title }}</h4>

          <p class="cat">{{ movie.category }}</p>

          <div class="ratings">
            <span *ngIf="movie.ParaTodosOAdultos" class="badge">{{ movie.ParaTodosOAdultos }}</span>
            <span *ngIf="movie.PegiRating" class="badge">{{ movie.PegiRating }}</span>
            <span *ngIf="movie.AgeRating" class="badge">{{ movie.AgeRating }}</span>
          </div>

          <div *ngIf="esAdmin" class="admin-controls">
            <button (click)="abrirModalEditar(movie); $event.stopPropagation()" class="edit-btn">Editar</button>
            <button (click)="confirmarEliminacion(movie.id); $event.stopPropagation()" class="delete-btn">Eliminar</button>
          </div>
        </div>
      </div>

      <section *ngIf="esAdmin" class="admin-panel">
        <h2>Panel de Administración</h2>
        <p>Desde aquí puedes agregar, editar o eliminar películas de la cartelera.</p>
        <button class="admin-add" (click)="abrirModalAgregar()">Agregar Película</button>
      </section>
    </main>
  </div>

  <!-- MODAL -->
  <ion-modal [isOpen]="modalAbierto" (didDismiss)="cerrarModal()">
    <ng-template>
      <ion-header>
        <ion-toolbar color="dark">
          <ion-title>{{ editando ? 'Editar Película' : 'Agregar Película' }}</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="cerrarModal()">Cerrar</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <ion-content class="ion-padding">

        <ion-item>
          <ion-label position="floating">Título</ion-label>
          <ion-input [(ngModel)]="peliculaTemp.title" required></ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="floating">URL de la imagen</ion-label>
          <ion-input [(ngModel)]="peliculaTemp.imageUrl" required></ion-input>
        </ion-item>

        <ion-item>
          <ion-label>Categoría</ion-label>
          <ion-select [(ngModel)]="peliculaTemp.category" interface="alert">
            <ion-select-option *ngFor="let cat of categorias" [value]="cat">{{ cat }}</ion-select-option>
          </ion-select>
        </ion-item>

        <ion-item>
          <ion-label position="floating">Descripción</ion-label>
          <ion-textarea [(ngModel)]="peliculaTemp.description"></ion-textarea>
        </ion-item>

        <ion-item>
          <ion-label position="floating">URL del tráiler</ion-label>
          <ion-input [(ngModel)]="peliculaTemp.trailerUrl"></ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="floating">URL de la película</ion-label>
          <ion-input [(ngModel)]="peliculaTemp.movieUrl"></ion-input>
        </ion-item>

        <!-- NUEVO: Para Todos o Adultos -->
        <ion-item>
          <ion-label>Público</ion-label>
          <ion-select [(ngModel)]="peliculaTemp.ParaTodosOAdultos" interface="alert">
            <ion-select-option value="Para Todos">Para Todos</ion-select-option>
            <ion-select-option value="Adultos">Solo Adultos</ion-select-option>
          </ion-select>
        </ion-item>

        <!-- NUEVO: PEGI -->
        <ion-item>
          <ion-label>PEGI</ion-label>
          <ion-select [(ngModel)]="peliculaTemp.PegiRating" interface="alert">
            <ion-select-option value="PEGI 3">PEGI 3</ion-select-option>
            <ion-select-option value="PEGI 7">PEGI 7</ion-select-option>
            <ion-select-option value="PEGI 12">PEGI 12</ion-select-option>
            <ion-select-option value="PEGI 16">PEGI 16</ion-select-option>
            <ion-select-option value="PEGI 18">PEGI 18</ion-select-option>
          </ion-select>
        </ion-item>

        <!-- NUEVO: Age Rating -->
        <ion-item>
          <ion-label position="floating">Age Rating</ion-label>
          <ion-input [(ngModel)]="peliculaTemp.AgeRating" placeholder="Ej: +13, PG-13"></ion-input>
        </ion-item>

        <ion-button expand="block" color="warning" (click)="guardarPelicula()">
          {{ editando ? 'Guardar Cambios' : 'Agregar Película' }}
        </ion-button>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>
